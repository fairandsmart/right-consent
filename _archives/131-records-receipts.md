---
title: Records & receipts
permalink: /docs/records-receipts/
excerpt: "What are the characteristics and the differences between Records and Receipts"
toc: true
todo:
  - relire
---

Right Consents generates two types of output: Consent Records and Consent Receipts.

## Consent Record

![Record Anatomy](/right-consents/assets/images/record-anatomy.png)

Consent Records are designed to **store the answers** of an end-user regarding a consent or a preference. The goal is to **create a ground truth** (more or less like an access control list) that will be queried when needed. It has to give **very fast query results** and should avoid any lock during its creation to enable a **good throughput in writing** new values.

Consent Records are **stored atomically**. That means that if a Consent Form holds 6 elements (2 processings and 4 preferences for example), 6 records will be generated within **the same transaction id**. It allows you to retrieve a value for a specific element key or serial and to evaluate this value in another form composition (aka with different elements displayed).

Consent Records take into consideration answers given for a **specific model version** (cf page "Model lifecycle" for more information). A global serial number is generated by combining the serial number of the basic information model displayed in the form and the serial number of the element consented. If one of those two serial numbers is no more valid in a query, all records with that serial will be regarded as invalid.

Consent Records **store the value** given by the end-user for a particular element. Depending on the element type it can be a boolean, a string or a list of string.

Finally, it **keeps track** of the context by storing extra information like the author, attributes or even a comment.

The **status validity** of a record is **NOT stored** in the database to avoid complex updates. It is a transient information **evaluated at runtime**. The evaluation algorithm uses a query context to extract relevant records and then **applies a set of specific rules** to determine a status: *VALID, OBSOLETE, EXPIRED, IRRELEVANT, UNKNOWN*. **Business rules can be customized** to bring in specific behaviour in status determination (for example by taking into consideration the consent collection place). Evaluation status can then differ if the query context is not the same, even for a single element.

Consent Record storage is designed to be **effective in writing** but also **effective at evaluation time**. It is stored in a single table but specific index (and sharding) strategies are possible in that objective.

## Consent Receipt

Consent Receipts are **unique for a single transaction**. There is a one-to-many association between the Consent Receipt and the Consent Record. The Consent Receipt is the proof the consent has been faithfully collected.

Consent Receipts are designed to act more or less **like any classic receipt**. It is a single document that **contains information** on choices made at a particular time and with a specific context and conditions between an end-user and a data controller. That document should be **opposable** to any counterpart in case of conflict or in any need to modify choices.

Consent Receipts have to **be portable** and to allow its holder to use it at any moment to **express any change**. That is why it also contains a link to an online form with a valid context allowing the end user to retrieve his previously given values and to change any of them at any time.

Consent Receipts use a **XML format** but can also be transformed in a **PDF document** using classic XSL stylesheets. The XML format was choosen for its **portability in machine to machine communications** where the PDF format is interesting for **human to human interactions**. Both formats can be timestamped or signed to **reinforce the intention** of counterparts and to add a real proof level with technologies like [XAdES](https://www.w3.org/TR/XAdES/) and PAdES. 

Finally, the signature of a consent receipt (or its pdf attachment) can **condition the state** of associated records, waiting for the signature to be effective in order to **commit the transaction** and to take the state of records from PENDING to COMMITTED. This 2PC mechanism aims to allow long time validation process. The signature can also be a simple handwritten mark made on a tablet or an audio record of approbation because **any type of data can be inserted as attachment** of a receipt.

